# 《卡莱战纪》- 第一款开放逻辑区块链游戏

是的，你没看错，是开放逻辑而不仅仅是开放世界。

从模拟人生，侠盗飞车到Minecraft, 大家都在谈论开放世界。玩家看似脱离了设计者上帝的剧本束缚，自由自在倒行逆施，放飞灵魂。但是他们真的在游戏里摆脱上帝了么？他们仍在设计者规则框架里行动，哪怕他们认为是Bug。

区块链技术为我们提供这样一种可能：**假如玩家不喜欢这个上帝，那么就换一个**。《卡莱战纪》将是对这种理念的第一次尝试。

《卡莱战纪》是一款区块链卡牌游戏。游戏基本原理非常简单：

玩家持有若干卡牌，分别属于步兵、弓箭手、骑兵中的一种，每张卡牌4x4的格子，每个格子的士兵有不同的等级。玩家被允许将若干卡牌新建或投入一场PvP的战斗，该战斗将在某区块高度("区块高度"相当于区块链世界里的时间)结算，战斗的胜利者们的参战卡牌将会瓜分固定的分数奖励，这个分数将影响卡牌合并时新卡牌的品质。此外玩家也可以将卡牌放到商店自由交易。

![Battle](pics/Battle.jpg)



目前为止似乎并没看到什么特殊地方。那是因为我们还没有仔细讨论一个关键过程：战斗。

战斗如何进行，如何决定胜负？胜利者们如何分配奖励？我们把这部分制定成一个智能合约接口：一组动态调用的函数(见文末伪代码)。有兴趣为《卡莱战纪》开发插件的开发者们只要遵循这个接口，就能自主设计专门实现战斗功能的插件智能协约。

设计好的战斗插件既有挑战又有利益。

挑战在于：《卡莱战纪》的卡牌定义为开发者的设计策略性提供了足够大的纵深空间：

插件协约可以是纯粹去中心化智能协议代码，也可以仅仅是某个依赖中心化服务器的玩法报名表。

可以根据某种原则在一幅地图上实现兵种的生克(黎巴嫩山脉或两河平原)，也可以强调布阵与平衡。

可以引入非常大的随机性吸引赌徒，也可以纯靠策略如同象棋。

插件开发者甚至可以开发自己的专用客户端来表现自己独特的战斗过程来吸引玩家。



![plugins](pics/plugins.png)





```C#
/** CarryBattle Plugin War Smart Contract Interface (Peudocode)
*
* Notes:
* 1. The types of the parameters may vary in response of the restrictions of different chains. This is the Peudocode for reference.
* 2. The source contract has already done the validation work of the input parameters such as card ownership and availablity. The plugin can focus on logic realization.

* 卡莱战纪插件战斗智能合约接口(伪代码)
* 注意：
* 1. 参数类型会根据不同主链限制做调整。此处只是做参考的伪码。
* 2. 母合约已经对输入参数进行合法检测，诸如卡牌所有权与可用性。插件可以集中在自身逻辑实践上。
*/


interface CBWar: SmartContract{
    
    /** Does it allow a player with a particular set of cards to create a war?
    * 是否允许一个玩家及一组牌创建战斗
    * @param playerID: the playerID applying to create the war.
    * @param cardIDs: the array of the cards to create a war.
    * @return: The blockchain height of finalization. If the return value is equal or less than the required minimal value, it means the creation is invalid.
    */
    public BigInteger AllowCreate(BigInteger playerID, BigInteger[] cardIDs){}
    
    
    /** Use a player with a particular set of cards to create a war?
    * 使用一个玩家及一组牌创建战斗
    * @param playerID: the playerID applying to create the war.
    * @param cardIDs: the array of the cards to create a war.
    * @param warID: the warID allocated by the source contract. 
    * @return: The blockchain height of finalization. If the return value is equal or less than the required minimal value, the warID would be recycled.
    */
    public BigInteger Create(BigInteger playerID, BigInteger[] cardIDs, BigInteger warID){}
    
    
    /** Does it allow a player with a particular set of cards to join the war?
    * 是否允许一个玩家及一组牌加入战斗
    * @param playerID: the playerID applying to join the war.
    * @param cardIDs: the array of the cards to join a war.
    * @param warID: the warID allocated by the source contract. 
    * @return: If the return value is -1, the player cannot join the war. Else return the order of the player in this war.
    */
    public BigInteger AllowJoin(BigInteger playerID, BigInteger[] cardIDs, BigInteger warID){}  
    
    
    /** Use a player with a particular set of cards to join the war
    * 使用一个玩家及一组牌加入战斗
    * @param playerID: the playerID applying to join the war.
    * @param cardIDs: the array of the cards to join a war.
    * @param warID: the warID allocated by the source contract. 
    * @return: If the return value is -1, the player cannot join the war. Else return the order of the player in this war.
    */
    public BigInteger Join(BigInteger playerID, BigInteger[] cardIDs, BigInteger warID){}
    
    
    /** Does it allow a player with a particular set of cards to retreat from the war?
    * 是否允许一个玩家及一组牌加入战斗
    * @param playerID: the playerID applying to join the war.
    * @param cardIDs: the array of the cards to join a war.
    * @param warID: the warID allocated by the source contract. 
    * @return: Allow or not. Failure may due to a lot of reasons. Plugin should 
    */
    public Boolean AllowRetreat(BigInteger playerID, BigInteger[] cardIDs, BigInteger warID){}  
    
    /** Use a player with a particular set of cards to join the war
    * 使用一个玩家及一组牌加入战斗
    * @param playerID: the playerID applying to join the war.
    * @param cardIDs: the array of the cards to join a war.
    * @param warID: the warID allocated by the source contract. 
    * @return: Success or not.
    */
    public Boolean Retreat(BigInteger playerID, BigInteger[] cardIDs, BigInteger warID){}
    
    
    
    /** The result of a war.
    * @param playerID: the playerID applying to join the war.
    * @param cards: the array of the cards to join a war.
    * @param warID: the warID allocated by the source contract. 
    * @return: The percentage of the award with the order of the players and cards. If the value of a byte exceeds 99 or the sum reaches equal or greater than 100, the related card would take all the left percentage, and the rest of cards would receive 0.
    */
    public byte[] Finalize(BigInteger warID){}
    
    /** The address for the plugin developer to receive the royalty*/
    public Address GetRoyaltyOwner(){}
    
    /** The royalty rate. With a decimal TBD*/
    public BigInteger GetRoyaltyRate(){}
    
    
}
```





