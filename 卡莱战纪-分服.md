# 《卡莱战纪》软分服 - 大规模链游解决方案



《卡莱战纪》是一款核心逻辑上链的区块链卡牌游戏。 是第一款在拜占庭共识网络上**模拟拜占庭将军问题**的链游, 同时也是第一款**靠去中心化连载小说推动**的链游。目前版本由norchain.io 基于NEO区块链基础设施研发。《卡莱》设计时着重考虑了如何能在区块链技术尚有许多限制的情况下尽可能体现其特质，同时探索其潜力。从而使得玩家在游戏获得的不仅是资产投资价值, 更是新鲜有趣的娱乐体验。

本篇主要叙述游戏的分服设计，其他内容请参看：

[总介绍](https://github.com/norchain/NEOCarryBattle/blob/master/README.md)

[核心玩法:在拜占庭网络上模拟拜赞庭将军问题](https://github.com/norchain/NEOCarryBattle/blob/master/%E5%8D%A1%E8%8E%B1%E6%88%98%E7%BA%AA-%E6%A0%B8%E5%BF%83%E7%8E%A9%E6%B3%95.md)

[用去中心化小说影响游戏，检验人性](https://github.com/norchain/NEOCarryBattle/blob/master/%E5%8D%A1%E8%8E%B1%E6%88%98%E7%BA%AA-%E5%B0%8F%E8%AF%B4.md)

[技术: Neunity框架，非对称熵，以及其他](https://github.com/norchain/NEOCarryBattle/blob/master/%E5%8D%A1%E8%8E%B1%E6%88%98%E7%BA%AA-%E6%8A%80%E6%9C%AF.md)





### 1. 分服的必要性及挑战

当玩家及道具量增大到一定程度时，调用智能合约时GAS成本很容易超标。比如：对一次涉及上百道具或玩家的查读写操作几乎必然超过10GAS。所以对大规模商业化链游, 链上分服几乎是必由之路。

分服设计的一个基本挑战是链游特有的资产价值敏感性带来的。中心化网游中，运营方可以根据各服玩家具体G点对不同服务器部署不同的配置以及空投不同资源，那是因为两服间资产一般不可相互流通。但链游核心特质之一是数字资产流通性开放，所以如果还一如既往依靠中心化节点分配资源，必然容易打击玩家投资及参与积极性，游戏就很难有持续发展性。

然而如果靠合约硬写入分服参数，万一某项数值不合理或随时间流动玩家兴趣转移，就容易影响全服玩家体验。

![ProbServers](pics/ProbServers.jpg)



### 2. 软分服方案

我们设计了**软分服**方案。基本原则为两条：

1. 运营方（也可能完全下放给玩家）可不定时开新服，自由采用不同配置和内容（比如不同城池部署、不同副本，见下文第3章），但一旦开服就不允许修改参数。
2. 不限制任何玩家转服，但是针对该玩家与该服平均等级差来影响其收益比例，并根据该服现有人数多少收取不等入服费用。

如下图所示，这样的设计会因为玩家自己平衡利弊最后自然形成各服相对集中的等级区间，及玩家们自己觉得舒适的总人数。

![SoftServers](pics/SoftServers.jpg)



除了经济因素外，每个分服作为一个社区(结合链上游戏及Discord频道)，其开服设置和社区氛围(见[小说篇](https://github.com/norchain/NEOCarryBattle/blob/master/%E5%8D%A1%E8%8E%B1%E6%88%98%E7%BA%AA-%E5%B0%8F%E8%AF%B4.md)第4章)对玩家的实际体验是可能造成正负两方面加成影响的。

一个分服的发展包括一下四个阶段：

**拓荒期**：此阶段玩家极少，入服费用几乎忽略不计。玩家都能占有城池收税。但由于人太少没什么仗可打，所以实际收益并不多。

**发展期**：此阶段人口进入健康发展期，有足够的活跃度来支持玩家



![ServerDiagram](pics/ServerDiagram.jpg)

### 3. 软分服配置

玩家有不同的体验需求。有人喜欢玩爽，希望快速战斗也不想思考援军、叛徒之类的复杂因素。有人则喜欢细致长考，深刻分析局势并到链外社区拉拢人头后才开始一战。有人喜欢体验拜占庭问题假假真真，有人则更倾向无法倒戈的传统联盟战争。为尽量满足大多数玩家需求，开新服时需要提供如下表服务器参数：

| 参数名             | 含义                                        | 影响                                                         |
| ------------------ | ------------------------------------------- | ------------------------------------------------------------ |
| is_asymmentropy    | 是否采用非对称熵方法                        | 如果非，游戏演化为普通组团PvP游戏，逻辑简化成一个阶段，行军完毕就结算。 |
| is_force_notify    | 是否强制在行动阶段广播自己的目标            | (“广播”见技术篇2.2) 如果值为no，玩家行为可能更迷雾           |
| is_cloak_dest      | 是否隐瞒目的地                              | 如果非，那玩家拜占庭问题复杂度不不包括目的地，只包括玩家支持立场 |
| interval_action    | 非对称熵方法中的行动时间长度                | 越长越支持复杂大规模团战。                                   |
| interval_check     | 非对称熵方法中的验证时间长度                | 越长越支持复杂大规模团战。                                   |
| cooldown_nocheck   | 对验证阶段不发送check的玩家的惩罚(冷却时间) | 决定该服是否支持玩家乱放烟雾                                 |
| interval_min_novel | 小说更新最小时间间隔                        |                                                              |
| join_fee_factor    | 入服费用因子                                | 越大，分服人数变多时入服费用就会迅速增大。                   |
|                    |                                             |                                                              |
| ...                | 其他参数                                    |                                                              |

其中，最接近模拟真实世界的玩法是提供最小确定性信息的玩法: 

> {**is_asymmentropy** :true, **is_force_notify**:false, **is_cloak_dest**: true, **interval_declaim**: long, **interval_check** : long, **cooldown_nocheck**: 0, **interval_min_novel**: short }

在做决定前你有很长时间仔细查阅资料及思考，但是你不知道别人是敌是友，不知道其意图。虽然有一帮人各自宣称自己支持谁，但不到最终一刻谁也不知道谁是真的盟友。所有人有权始终保持沉默，骗了你也不会得到直接惩罚。为了弥补身心怅然，你有一部旧约故事可读可辩。



最简单直接的玩法是信息确定性最强玩法:

> {**is_asymmentropy**: false, **is_force_notify**:true, **is_cloak_dest**: false, **interval_declaim**: 0, **interval_check** : ~0, **cooldown_nocheck**: ~0, **interval_min_novel**: extremely_long}

本地调整好卡牌阵型后一键开打（降维成大掌门那样1v1的传统卡牌对战游戏）：

在这两种极端之间，可预期有多种合理的配置组合让每种玩家都能找到自己的乐趣。即使配置并不合理，玩家可以转服，不会造成过坏影响。







此外，不管分服如何配置，每次战斗总收益上限始终是与interval_action+interval_check 成正比的。因此保证不管在哪个服务器配置情况下在单位时间里总收益不会浮动太大。



## 常见疑问

**欢迎通过[Discord](<https://discord.gg/pKQyyrP> )提交问题，我们将尽快给予回答或讨论，以更好完善游戏设计。**

